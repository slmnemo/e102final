\documentclass[10pt]{article}
\usepackage{blindtext}
\usepackage[total={7in, 9in}]{geometry}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}

% Title Page
\title{E102 Final Report}
\author{Pierce Gruber, Kaitlin Lucio}


\begin{document}
\maketitle

\begin{abstract}
Moving a cart with an inverted pendulum is an inherently tricky system as it requires both disturbing and maintaining an unstable equilibrium to move the cart to a desired location. One method to solve this problem is using a state-space system in feedback to calculate the needed acceleration vector using an observer to correct for non-linearities in the system. In doing so, the pendulum may be maintained as upright while still moving the cart according to a desired position without overshoot. This report describes one such process and solution for such a system using MATLAB.
\end{abstract}

\section{Problem Statement}
A cart with an inverted pendulum of length $L = 0.5\text{ m}$ and a max acceleration of $|\text{a}(t)| < 0.5 \text{ m}/\text{sec}^2$ and is subject to an angular acceleration disturbance $\alpha(t) = 0.5$ rad$/\text{sec}^{2}$. The cart must move to a final displacement from its starting location of $10$ m within an overall time limit of $10$ seconds without overshooting its target.

The cart is able to measure its displacement $s(t)$ and its current pendulum angle $\theta(t)$.

\begin{center}
    \includegraphics{graphs/invpen.png}
\end{center}

The governing equations for this system are given by the following

\begin{align*}
    L\frac{d^{2}\theta}{dt^{2}} &- g\text{sin}(\theta(t)) = -a(t)\text{cos}(\theta(t)) + L\alpha(t) \\
    \frac{d^2s}{dt^2} &= a(t)
\end{align*}

Rearranging yields the following governing equations

\begin{align*}
    \frac{d^{2}\theta}{dt^{2}} &= \frac{g}{L}\text{sin}(\theta(t)) - \frac{1}{L}a(t)\text{cos}(\theta(t)) + \alpha(t) \\
    \frac{d^2s}{dt^2} &= a(t)
\end{align*}

and for a state-space set of equations, we must linearize this. Using $\text{sin}(\theta) = \theta$ and $\text{cos}(\theta) = 1$, we get

\begin{align*}
    \frac{d^{2}\theta}{dt^{2}} &= \frac{g}{L}\theta - \frac{1}{L}a(t) + \alpha(t) \\
    \frac{d^2s}{dt^2} &= a(t)
\end{align*}

Given state vector $\bar{x} = \begin{bmatrix} \theta \\ \dot{\theta} \\ s \\ \dot{s} \end{bmatrix}$ and control input $u = a(t)$, a disturbance $\omega = \alpha(t)$, and an output vector $\bar{y} = \begin{bmatrix} \theta \\ s \end{bmatrix}$, we can write out a set of matrices for this system when not in any sort of feedback. This results in the following matrices for the state space equations $\dot{\bar{x}} = A\bar{x} + Bu$ and $\bar{y} = C\bar{x} + Du$. Note that our $\bar{x}$ implies $\dot{\bar{x}} = \begin{bmatrix} \dot{\theta} \\ \ddot{\theta} \\ \dot{s} \\ \ddot{s} \end{bmatrix}$

\begin{center}
    \begin{tabular}{| c | c |}
        \hline
        A & $\begin{bmatrix}
                0 & 1 & 0 & 0 \\
                \frac{g}{L} & 0 & 0 & 0 \\
                0 & 0 & 0 & 1 \\
                0 & 0 & 0 & 0
             \end{bmatrix}$ \\
        \hline
        B & $\begin{bmatrix}
                0 \\ -\frac{1}{L} \\ 0 \\ 1
             \end{bmatrix}$ \\
        \hline
        C & $\begin{bmatrix}
                1 & 0 & 0 & 0 \\
                0 & 0 & 1 & 0
             \end{bmatrix}$ \\
        \hline
        D & $\begin{bmatrix}
                0 \\ 0
             \end{bmatrix}$ \\
        \hline
    \end{tabular}
\end{center}

where we ignore the disturbance $\alpha(t)$.

We note that for our system as described above, we can calculate $M_c$ and $M_o$. This results in the following matrices.

\begin{center}
    \begin{tabular}{| c | c |}
        \hline
        $M_c$ & $\begin{bmatrix}
                0 & -2 & 0 & -39.2 \\
                -2 & 0 & -39.2 & 0 \\
                0 & 1 & 0 & 0 \\
                1 & 0 & 0 & 0
             \end{bmatrix}$ \\
        \hline
        $M_o$ & $\begin{bmatrix}
                1 & 0 & 0 & 0 \\
                0 & 0 & 1 & 0 \\
                0 & 1 & 0 & 0 \\
                0 & 0 & 0 & 1
             \end{bmatrix}$ \\
        \hline
    \end{tabular}
\end{center}

which are both invertible and thus the system is both invertible and controllable.

<<<<<<< Updated upstream
=======
In addition, we created a Simulink model for simulation with saturation. This is pictured along with any MATLAB code in the Appendix.

\section{State Space Design for Linear System}

Now we will design a controller in feedback to tune the poles of the system to have the desired response characteristics. We will also design an observer to estimate the state of the system quickly and implement integral action to deal with the disturbance and ensure 0 steady state error without overshoot.

Since our input is 1D and our state is 4D, we will have a fifth order system. To make designing the poles easier, we can place two of the poles to be dominant to make the system behave like 2nd order. The other three poles could then be placed to be much faster than the dominant poles so as to not contribute to the system dynamics.

To find where to place the dominant poles to satisfy the desired response characteristics, we can assume $\zeta \ge 1$ to allow for no overshooting. To find a starting point for $\omega_n$, we can solve the critically damped general equation for a unit step input and settling time (within 99\%) of 10 seconds:

\begin{align*}
    x(t_s) &= 0.99 = \frac{1}{\omega_n^2}(1-e^{-\omega_nt_s} - \omega_nt_se^{-\omega_nt_s}) \\
    t_s &= 8
\end{align*}

Plugging this into Wolfram Alpha, $\omega_n \approx 1$. This was the starting point for the poles to be tuned. A MATLAB script was then written to find the roots of the characteristic polynomial, the dominant poles, given $\zeta$ and $\omega_n$. The non-dominant poles were then placed to be approximately ten times faster than the dominant poles.

Now that we have poles, we need to calculate the feedback matrices for an integral action system so that we can use the place command. Note that since our integral action only acts on one output, we only use the row from $C$ which is multiplied by $s$. This results in the following matrices

\begin{center}
    \begin{tabular}{| c | c |}
        \hline
        $A_{af}$ & $\begin{bmatrix}
                0 & 0 & 0 & -1 & 0 \\
                0 & 0 & 1 & 0 & 0 \\
                0 & \frac{g}{L} & 0 & 0 & 0 \\
                0 & 0 & 0 & 1 \\
                0 & 0 & 0 & 0
             \end{bmatrix}$ \\
        \hline
        $B_{af}$ & $\begin{bmatrix}
                0 \\ 0 \\ -\frac{1}{L} \\ 0 \\ 1
             \end{bmatrix}$ \\
        \hline
        $C_{af}$ & $\begin{bmatrix}
                0 & 0 & 0 & 1 & 0
             \end{bmatrix}$ \\
        \hline
        $D_{af}$ & $\begin{bmatrix}
                0 \\ 0
             \end{bmatrix}$ \\
        \hline
    \end{tabular}
\end{center}

\section{Simulation of Nonlinear System using Linear Controller}

The model was simulated via Simulink and the displacement over time graph was obtained. Then, we tuned the controller poles by changing $\zeta$ and $\omega_n$ slightly until the desired characteristics of the response was obtained.

The result was: $\omega_n = 2.3$ and $\zeta = 1$. The graphs are shown below.

\section{Results and Conclusion}

>>>>>>> Stashed changes
\end{document}
